{% extends 'blog/default/base.html' %}
{% load staticfiles %}
{% load duoshuo_tags %}
{% load has_group %}
{% load threadedcomments_tags %}

{% block title %}{{ article.title }} | 博客 | 安好{% endblock %}

{% block headBlock %}
    <link rel="stylesheet" href="{% static 'mycomments/css/mycomments.css' %}">
{% endblock headBlock %}

{% block blogColumn %}
<!-- Blog Post -->
<article>
    <!-- Title -->
    <h1>{{ article.title }}</h1>

    <!-- Author -->
    <p class="lead">
        由
        <a href="#">
            {% if article.author.first_name or article.author.last_name %}
                {{ article.author.last_name|addstr:article.author.first_name|truncatechars:9  }}
            {% else %}
                {{ article.author.username|truncatechars:9 }}
            {% endif %}
        </a>
    </p>

    <hr>

    <!-- Date/Time -->
    <p><span class="glyphicon glyphicon-time"></span>
        发布于 {{ article.date_publish }}
    </p>
    <p>
    {% for c in article.categories.all %}
        <a href="{% url 'blog:category_archive_view' slug=c.slug %}"><span class="label label-default">{{ c.title }}</span></a>
    {% endfor %}
    </p>

    <hr>

    {% if article.cover %}
        <img class="img-responsive" src="{{ article.cover.url }}" alt="">
        <hr>
    {% endif %}


    <p class="lead">
        {{ article.excerpt }}
    </p>

    {{ article.get_content_markup|safe }}
    <div class="row">
        <div class="col-lg-12 text-center">

        <form action="https://shenghuo.alipay.com/send/payment/fill.htm" method="POST" target="_blank" accept-charset="GBK">
            <input name="optEmail" type="hidden" value="aplusplus@qq.com" />
            <input name="payAmount" type="hidden" value="10" />
            <input id="title" name="title" type="hidden" value="博客赞助" />
            <input name="memo" type="hidden" value="备注" />
            <input name="pay" type="image" value="转账" src="{% static 'blog/img/donate.png' %}" />
        </form>
        </div>
    </div>

    {% if user|has_group:'authors' and user == article.author %}
    <p>
        <a href="{% url 'blog:edit_post_view' post_id=article.id %}" style="font-size: 20px;">编辑本文</a>
    </p>
    {% endif %}

    <hr>

    {% render_comment_list for article %}

    <hr>

    {% render_comment_form for article %}

    <div class="row">
        <div class="col-lg-12">
            {% my_sso_duoshuo_comments 'blog-'|addstr:article.id '博客-'|addstr:article.title request.build_absolute_uri request.path|escape %}
        </div>
    </div>

</article>
{% endblock blogColumn %}

{% block extScriptFile %}
    <script src="{% static 'mycomments/js/mycomments.js' %}"></script>
    {% if user.is_authenticated %}
    <script>
        jQuery(function($) {
            setAuthenticatedUser();
        });
    </script>
    {% endif %}
{% endblock extScriptFile %}
